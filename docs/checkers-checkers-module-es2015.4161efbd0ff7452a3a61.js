(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"3wOr":function(e,t,i){"use strict";i.r(t),i.d(t,"CheckersModule",(function(){return k}));var s=i("PCNd"),a=i("iInd"),r=i("mrSG");let o=(()=>{class e{constructor(e){this.state=e}static checkerBuilder(t,i,s){const a={color:e.colors[t.state.id],player:t,position:i,radius:s,isKing:!1,center:e.getCenter(i,s)};return new e(a)}static getCenter(e,t){return{x:e.point.x+t,y:e.point.y+t}}updatePosition(e){this.state.position.point=e}makeKing(){this.state.isKing=!0}}return e.colors=["dodgerblue","goldenrod"],e})();var n=i("BFKe");let h=(()=>{class e{constructor(e){this.state=e}static boxBuilder(t,i,s){const a={id:`${i.cell.row}${i.cell.column}`,color:t?e.colors.playable:e.colors.unPlayable,checker:t?e.empty:e.unplayableSpace,position:i,width:s,height:s,absoluteCenter:n.a.findAbsoluteCenterPointOfRectangle(i,s,s),relativeCenter:n.a.findRelativeCenterPointOfRectangle(s,s)};return new e(a)}buildChecker(e){const{cell:t,point:i}=this.state.position;this.state.checker=o.checkerBuilder(e,{cell:t,point:i},Math.floor(.46*this.state.width))}hasChecker(){return this.state.checker!==e.empty&&this.state.checker!==e.unplayableSpace}addChecker(e){e.state.position.cell=this.state.position.cell,e.state.position.point=this.state.position.point,this.state.checker=e}removeChecker(){this.state.checker=e.empty}checkForValidChecker(e){return!!this.hasChecker()&&e.state.id===this.state.checker.state.player.state.id}}return e.colors={playable:"palegreen",unPlayable:"darkgray"},e.empty="empty",e.unplayableSpace="unplayable space",e})(),c=(()=>{class e{constructor(e){this.state=e}static boardBuilder(t){e.boxSize=e.calculateBoxSize();const i=e.calculateTopPadding(),s=e.calculateSidePadding(),a={rows:e.rows,columns:e.columns,boxes:new Map,topPadding:i,sidePadding:s,playerOneCheckersRemaining:12,playerTwoCheckersRemaining:12,availableMoves:[]},r=t[0],o=t[1];for(let c=0;c<a.rows;c++)for(let t=0;t<a.columns;t++){const i=n.a.isOdd(c+t),s={row:c,column:t},l=e.calculateBoxPositions(s,a.topPadding,a.sidePadding),d=h.boxBuilder(i,{cell:s,point:l},e.boxSize);i&&(c<3?d.buildChecker(r):c>4&&d.buildChecker(o)),a.boxes.set(`${c}${t}`,d)}return new e(a)}static calculateBoxPositions(t,i,s){return{x:t.column*e.boxSize+s,y:t.row*e.boxSize+i}}static calculateBoxSize(){return innerWidth>innerHeight?innerHeight/(e.rows+2):innerWidth/(e.rows+2)}static calculateTopPadding(){return innerWidth>innerHeight?e.boxSize:(innerHeight-8*e.boxSize)/2}static calculateSidePadding(){return innerWidth>innerHeight?(innerWidth-8*e.boxSize)/2:e.boxSize}setupBoardState(e){this.state={rows:8,columns:8,boxes:new Map,topPadding:null,sidePadding:null,playerOneCheckersRemaining:12,playerTwoCheckersRemaining:12,availableMoves:null},this.buildBoard(e),this.state.availableMoves=[]}buildBoard(t){const i=t[0],s=t[1];this.state.boxes=new Map;for(let a=0;a<this.state.rows;a++)for(let t=0;t<this.state.columns;t++){const r=n.a.isOdd(a+t),o={row:a,column:t},c=this.getBoxPosition(a,t),l=h.boxBuilder(r,{cell:o,point:c},e.boxSize);r&&(a<3?l.buildChecker(i):a>4&&l.buildChecker(s)),this.state.boxes.set(`${a}${t}`,l)}}removeCheckerFromBoard(e){this.decreasePlayersCheckers(e.state.checker),e.removeChecker()}decreasePlayersCheckers(e){0===e.state.player.state.id?this.state.playerOneCheckersRemaining--:this.state.playerTwoCheckersRemaining--}getBox(e){return this.state.boxes.get(`${e.row}${e.column}`)}getBoxPosition(t,i){return{x:i*e.boxSize+this.state.sidePadding,y:t*e.boxSize+e.boxSize}}getBoxIndex(t,i){return{row:Math.floor((i-this.state.topPadding-40)/e.boxSize),column:Math.floor((t-this.state.sidePadding)/e.boxSize)}}getBoxesArray(){const e=[];for(let t=0;t<this.state.rows;t++)for(let i=0;i<this.state.columns;i++)e.push(this.state.boxes.get(`${t}${i}`));return e}resetAvailableMoves(){this.state.availableMoves=[]}getAllMoves(e){const{isKing:t,player:i}=e.state.checker.state,s=[],{row:a,column:r}=e.state.position.cell;return(1===i.state.id||t)&&(a>0&&r>0&&s.push(this.state.boxes.get(`${a-1}${r-1}`)),a>0&&r<this.state.columns-1&&s.push(this.state.boxes.get(`${a-1}${r+1}`))),(0===i.state.id||t)&&(a<this.state.rows-1&&r>0&&s.push(this.state.boxes.get(`${a+1}${r-1}`)),a<this.state.rows-1&&r<this.state.columns-1&&s.push(this.state.boxes.get(`${a+1}${r+1}`))),s}getAvailableMove(e){const t=this.state.availableMoves.findIndex(t=>t.end.state.position.cell===e.state.position.cell);return this.state.availableMoves[t]}setAvailableMoves(e){const t=this.getAllMoves(e);this.state.availableMoves=this.filterMoves(e,t)}filterMoves(e,t){const i=[],s=[],{player:a}=e.state.checker.state;return t.forEach(t=>{if(t.hasChecker()){if(this.checkIfOpponentChecker(t,a.state.id)&&this.checkIfJumpIsPossible(e.state.position.cell,t.state.position.cell)){const i=this.getJumpPosition(e.state.position.cell,t.state.position.cell),a=this.state.boxes.get(`${i.row}${i.column}`);s.push({start:e,end:a,isJump:!0,jumpedBox:t})}}else i.push({start:e,end:t,isJump:!1,jumpedBox:null})}),s.concat(i)}checkIfOpponentChecker(e,t){return t!==e.state.checker.state.player.state.id}checkIfJumpIsPossible(e,t){const{row:i,column:s}=this.getJumpPosition(e,t);return!(i<0||i>=8||s<0||s>=8||this.state.boxes.get(`${i}${s}`).hasChecker())}getJumpPosition(e,t){return{row:t.row-(e.row-t.row),column:t.column-(e.column-t.column)}}checkForWin(e){return 0===e?0===this.state.playerTwoCheckersRemaining:0===this.state.playerOneCheckersRemaining}checkIfKinged(e,t,i){(0===e&&t===this.state.rows-1||1===e&&0===t)&&i.makeKing()}checkForAdditionalJumps(e){const t=e.end;this.setAvailableMoves(t);const i=this.state.availableMoves.filter(e=>e.isJump);return i.length>0&&(this.state.availableMoves=i,this.state.availableMoves.push({start:t,end:t,isJump:!1,jumpedBox:null}),!0)}}return e.rows=8,e.columns=8,e})();class l{constructor(e){this.state=e}static playerBuilder(e,t){return new l({id:e-1,name:"Player "+e,color:t,numberOfPieces:16})}}var d=i("8Y7J");const u=["checkers"],g=[{path:"",component:(()=>{class e{constructor(){this.colors={playerOne:"dodgerblue",playerTwo:"goldenrod"}}ngOnInit(){this.setProperties(),this.setInitialState()}ngAfterViewInit(){this.getCheckerImageData()}setProperties(){this.ctx=this.canvas.nativeElement.getContext("2d"),this.canvasPadding=40}setInitialState(){this.playerOne=l.playerBuilder(1,this.colors.playerOne),this.playerTwo=l.playerBuilder(2,this.colors.playerTwo),this.playerBarWidth=20,this.currentPlayer=this.playerOne,this.holdingChecker=!1,this.isPlaying=!0,this.board=c.boardBuilder([this.playerOne,this.playerTwo]),this.halfBoxSize=.5*c.boxSize}setCanvasDimensions(){this.canvas.nativeElement.width=innerWidth,this.canvas.nativeElement.height=innerHeight-this.canvasPadding}getCheckerImageData(){return Object(r.a)(this,void 0,void 0,(function*(){const e=this.halfBoxSize,t=this.halfBoxSize,i=.46*c.boxSize;this.canvas.nativeElement.width=c.boxSize,this.canvas.nativeElement.height=c.boxSize,this.checkerImgPlayerOne=new Image,this.checkerImgPlayerOne.src=this.drawCheckerImage(e,t,i,this.colors.playerOne,!1),this.checkerImgPlayerTwo=new Image,this.checkerImgPlayerTwo.src=this.drawCheckerImage(e,t,i,this.colors.playerTwo,!1),this.checkerImgKingPlayerOne=new Image,this.checkerImgKingPlayerOne.src=this.drawCheckerImage(e,t,i,this.colors.playerOne,!0),this.checkerImgKingPlayerTwo=new Image,this.checkerImgKingPlayerTwo.src=this.drawCheckerImage(e,t,i,this.colors.playerTwo,!0),this.refreshCanvas(),yield this.loadImages([this.checkerImgPlayerOne,this.checkerImgPlayerTwo,this.checkerImgKingPlayerOne,this.checkerImgKingPlayerTwo]),this.setCanvasDimensions(),this.draw()}))}loadImages(e){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise((t,i)=>{for(const s of e)s.onload=()=>t(s),s.onerror=i})}))}getCheckerCenter(e,t){return{x:e-=this.halfBoxSize,y:t-=2*this.halfBoxSize}}handleClick(e){if(this.isPlaying){const t=this.board.getBoxIndex(e.clientX,e.clientY),i=this.board.getBox(t);if(i){if(this.holdingChecker){const e=this.board.getAvailableMove(i);e?this.placeChecker(e):this.returnChecker()}else i.checkForValidChecker(this.currentPlayer)&&(this.board.setAvailableMoves(i),this.board.state.availableMoves.length>0&&this.pickUpChecker(i)),this.lastBoxClicked=i;this.draw()}}}handleMouseMove(e){if(this.holdingChecker){const t=this.getCheckerCenter(e.clientX,e.clientY);this.checkerHeld.updatePosition(t),this.draw()}}pickUpChecker(e){this.holdingChecker=!0,this.checkerHeld=e.state.checker,e.removeChecker()}placeChecker(e){const t=this.currentPlayer.state.id,i=e.end.state.position.cell.row;let s;e.end.addChecker(this.checkerHeld),e.isJump&&(this.board.removeCheckerFromBoard(e.jumpedBox),s=this.board.checkForAdditionalJumps(e)),s?this.pickUpChecker(e.end):(this.checkerHeld.state.isKing||this.board.checkIfKinged(t,i,this.checkerHeld),this.board.checkForWin(this.currentPlayer.state.id)&&(this.isPlaying=!1,console.log(`Player ${this.currentPlayer.state.id+1} wins!`)),this.changePlayer(),this.board.resetAvailableMoves(),this.holdingChecker=!1,this.checkerHeld=null)}returnChecker(){const{x:e,y:t}=this.lastBoxClicked.state.absoluteCenter,i=this.getCheckerCenter(e,t);this.checkerHeld.updatePosition(i),this.lastBoxClicked.addChecker(this.checkerHeld),this.board.resetAvailableMoves(),this.holdingChecker=!1,this.checkerHeld=null}changePlayer(){this.currentPlayer=0===this.currentPlayer.state.id?this.playerTwo:this.playerOne}draw(){this.refreshCanvas(),this.drawPlayerBar(),this.drawBackground(),this.drawBoard(),this.board.state.availableMoves.length>0&&(this.drawHighlightedSpace(),this.drawAvailableMoves()),this.holdingChecker&&this.drawChecker(this.checkerHeld)}refreshCanvas(){this.ctx.clearRect(0,0,innerWidth,innerHeight-2*this.canvasPadding)}drawPlayerBar(){this.ctx.fillStyle=this.currentPlayer.state.color,this.ctx.fillRect(0,0,innerWidth,innerHeight-this.canvasPadding)}drawBackground(){const e=this.playerBarWidth,t=e,i=e,s=this.canvas.nativeElement.width-2*e,a=this.canvas.nativeElement.height-2*e;this.ctx.fillStyle="ivory",this.ctx.fillRect(t,i,s,a)}drawBoard(){this.board.getBoxesArray().forEach(e=>{this.drawBox(e),e.hasChecker()&&this.drawChecker(e.state.checker)})}drawChecker(e){const{x:t,y:i}=e.state.position.point;this.ctx.drawImage(0===e.state.player.state.id?e.state.isKing?this.checkerImgKingPlayerOne:this.checkerImgPlayerOne:e.state.isKing?this.checkerImgKingPlayerTwo:this.checkerImgPlayerTwo,t,i)}drawBox(e){const{color:t,width:i,height:s}=e.state,{x:a,y:r}=e.state.position.point;this.ctx.fillStyle=t,this.ctx.fillRect(a,r,i,s),this.ctx.lineWidth=.5,this.ctx.strokeStyle="black",this.ctx.strokeRect(a,r,i,s)}drawCheckerImage(e,t,i,s,a){const r=s===this.colors.playerOne?"deepskyblue":"gold";this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(e,t,i,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.strokeStyle=r,this.ctx.lineWidth=.05*c.boxSize;for(let o=0;o<2*Math.PI;o+=.18)this.ctx.beginPath(),this.ctx.arc(e,t,i-4,o,o+.04,!1),this.ctx.stroke();if(this.ctx.fillStyle=r,this.ctx.beginPath(),this.ctx.arc(e,t,i-10,0,2*Math.PI,!0),this.ctx.fill(),a){this.ctx.strokeStyle=s,this.ctx.lineWidth=.05*c.boxSize;const i=c.boxSize/95;this.ctx.beginPath(),this.ctx.moveTo(e+16*i,t+15*i),this.ctx.lineTo(e-15*i,t+15*i),this.ctx.lineTo(e-20*i,t-10*i),this.ctx.lineTo(e-10*i,t),this.ctx.lineTo(e,t-20*i),this.ctx.lineTo(e+10*i,t),this.ctx.lineTo(e+20*i,t-10*i),this.ctx.lineTo(e+15*i,t+15*i)}return this.ctx.stroke(),this.canvas.nativeElement.toDataURL("image/webp")}drawHighlightedSpace(){const{x:e,y:t}=this.lastBoxClicked.state.position.point,{width:i,height:s}=this.lastBoxClicked.state;this.ctx.fillStyle="white",this.ctx.fillRect(e,t,i,s)}drawAvailableMoves(){this.ctx.lineWidth=6,this.board.state.availableMoves.forEach(e=>{const{x:t,y:i}=e.end.state.position.point,{width:s,height:a}=e.end.state;this.ctx.strokeStyle="yellow",this.ctx.strokeRect(t,i,s,a)})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=d.Fb({type:e,selectors:[["app-checkers"]],viewQuery:function(e,t){var i;1&e&&d.gc(u,!0),2&e&&d.bc(i=d.Wb())&&(t.canvas=i.first)},decls:2,vars:0,consts:[[1,"canvas",3,"click","mousemove"],["checkers",""]],template:function(e,t){1&e&&(d.Ob(0,"canvas",0,1),d.Vb("click",(function(e){return t.handleClick(e)}))("mousemove",(function(e){return t.handleMouseMove(e)})),d.Nb())},styles:[""]}),e})()}];let p=(()=>{class e{}return e.\u0275mod=d.Jb({type:e}),e.\u0275inj=d.Ib({factory:function(t){return new(t||e)},imports:[[a.b.forChild(g)],a.b]}),e})(),k=(()=>{class e{}return e.\u0275mod=d.Jb({type:e}),e.\u0275inj=d.Ib({factory:function(t){return new(t||e)},imports:[[s.a,p]]}),e})()}}]);
//# sourceMappingURL=checkers-checkers-module-es2015.4161efbd0ff7452a3a61.js.map